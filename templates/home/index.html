{% extends "../includes/base.html" %}
{% block content %}
<style>
     .nav-link.active {
    background-color: #dc3545 !important; /* Bootstrap's danger color */
    color: #fff !important;
    border:0px
} 
</style>
<div class="container-fluid">
 
    <div >
           <h1 class="alert-heading mb-2 p-3"  >
            <i class="ci-map-pin animate-target fs-md "></i>
                Find Movies Near You 
            </h1>
        <div class="row mt-3 ">
            <!-- Controlled slider -->
            <div class="col-md-6 mb-4 mb-md-0 pb-0 pb-md-0">
                <div class="swiper" id="images" data-swiper='{
                "allowTouchMove": false,
                "effect": "flip",
                "flipEffect": {
                "slideShadows": false
                },
                "loop": true
            }'>
                    <div class="swiper-wrapper  ">

                        {% for movie in movies%}
                        <div class="swiper-slide ">
                            <a href="/{{movie.slug}}">
                                <img src="/media/{{movie.poster_image}}" alt="Image 1"
                                    style="height: 400px; width: 100%; object-fit: cover;"
                                    class="img-fluid rounded slider-image " />
                            </a>
                            <div class="position-absolute start-0 bottom-0 d-flex align-items-end w-100 h-100 z-2">
                                <button class="btn btn-md btn-success rounded-pill m-md-2" data-bs-toggle="modal"
                                    data-bs-trailer-url="{{ movie.trailer }}" data-bs-target="#trailer">
                                    <i class="ci-play fs-lg ms-n1 me-2"></i>
                                    Watch Traller
                                    </a>
                            </div>
                        </div>
                        {%endfor%}
                    </div>
                </div>
            </div>

            <!-- Master slider -->
            <div class="col-md-5 ps-xl-5">
                <div class="swiper" data-swiper='{
                    "spaceBetween": 32,
                    "loop": true,
                    "speed": 600,
                    "controlSlider": "#images",
                    "navigation": {
                    "prevEl": "#prev-btn",
                    "nextEl": "#next-btn"
                    }
                }'>
                    <div class="swiper-wrapper  text-md-start">

                        {% for movie in movies%}
                        <div class="swiper-slide pb-4 pt-0 ">
                            <h1 class="text-pretty">{{movie.title}}</h1>
                            <div class=" d-none d-md-block">
                                <p>{{movie.description|safe|linebreaks|truncatewords:30}}</p>
                                <!-- <b>Cast</b>
                                <p>
                                    {{movie.cast}}
                                </p> -->
                            </div>

                            <b>Screening in</b><br/>
                            <p>

                                {% for address in movie.filmshow.all %}
                                <a href="/show/{{ address.slug }}" class="text-decoration-none alert ">
                                <i class="ci-map-pin "></i> &nbsp;&nbsp;{{address.theater_name}} {{address.state.state_short|upper}} ({{address.show_date}} {{address.show_time}})
                                </a>
                                <br/>
                                {%endfor%}

                            </p>
                            <a href="/{{movie.slug}}" class="btn btn-md btn-danger" a><i class="ci-ticket"></i>
                                &nbsp;Grab a Ticket
                                &nbsp;&nbsp;
                                <i class="ci-chevron-right"></i>
                            </a>

                        </div>
                        {%endfor%}

                    </div>  
                </div>
                <div class="d-flex justify-content-center justify-content-md-start ">
                    <button type="button"
                        class="btn btn-icon btn-outline-secondary animate-slide-start rounded-circle me-1" id="prev-btn"
                        aria-label="Prev">
                        <i class="ci-chevron-left fs-lg animate-target"></i>
                    </button>
                    <button type="button" class="btn btn-icon btn-outline-secondary animate-slide-end rounded-circle"
                        id="next-btn" aria-label="Next">
                        <i class="ci-chevron-right fs-lg animate-target"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class=" p-0 p-md-3 p-lg-5 border-bottom">
        
        <!-- <div class="alert   alert-white pt-5 pb-0  " role="alert">
          <a href="/movies" class="text-decoration-none alert-heading" >  
            <h1 class="alert-heading mb-2"  >
            <i class="ci-map-pin animate-target fs-md "></i>
                Find Movies Near You 
            </h1>
                </a>
        </div> -->

        <!-- {% regroup upcomings by state as state_list %}
 
        
        <ul class="nav nav-pills mb-3" id="stateTab" role="tablist">
            {% for group in state_list %}
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if forloop.first %} active  {% endif %} " id="tab-{{ forloop.counter }}"
                    data-bs-toggle="tab" data-bs-target="#content-{{ forloop.counter }}" type="button" role="tab">
                   <i class="ci-map-pin animate-target fs-md "></i> &nbsp;&nbsp;
                   {{ group.grouper }}
                </button>
            </li>
            {% endfor %}
        </ul> -->

        
         
    <div class="alert   alert-white pt-5 pb-0 pt-sm-4" role="alert">
            <h1 class="alert-heading mb-2"><i class="ci-gift fs-md  "></i> Events</h1>
        </div>
       
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
            {% for event in events%}
            <div class="col">
                <div
                    class="card h-100 animate-underline hover-effect-opacity hover-effect-scale rounded-4 overflow-hidden">
                    <div class="card-img-top position-relative bg-body-tertiary overflow-hidden">
                        <a class="ratio d-block hover-effect-target" style="--cz-aspect-ratio: calc(220 / 304 * 100%)"
                            href="/event/{{event.slug}}">
                            <img src="/media/{{event.poster_image}}" class="w-100 h-100 object-fit-cover" alt="Image">
                        </a>
                         
                    </div>
                    <div class="card-body p-3">
                        <div class="d-flex min-w-0 justify-content-between gap-2 gap-sm-3 mb-2">
                            <h3 class="nav min-w-0 mb-0">
                                <a class="nav-link text-truncate p-0" href="/event/{{event.slug}}">
                                    <span class="text-truncate animate-target">{{event.title}}</span>
                                </a>
                            </h3>
                            <div class="h6 mb-0 text text-success">
                                {%if event.price == 0%}
                                Free
                                {%else%}
                                ${{event.price}}
                                {%endif%}
                            </div>
                        </div>
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
                            <div class="nav align-items-center gap-1 fs-xs">

                                <i class="ci-schedule"></i>
                                In {{event.place}},{{event.state.state_short|upper}}
                                <div class="text-body-secondary">on </div>
                                {{event.show_date}} at {{event.show_time|date:'h:i A'}}
                            </div>
                            <small><span class="text text-info"> <i class="ci-ticket"></i> {{event.event_type}}</span></small>
                        </div>
                    </div>
                </div>
            </div>
            {%endfor%}


        </div>
    </div>

    <div class="modal fade" id="trailer" tabindex="-1" aria-labelledby="trailerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header ">

                    <button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">

                      <iframe id="modalTrailerVideo" width="100%" height="90%" 
                        src=""
                         title="YouTube video player" frameborder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                          referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                </div>
            </div>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    const trailerModal = document.getElementById('trailer');
    const videoIframe = document.getElementById('modalTrailerVideo');

    // When the modal is about to show
    trailerModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget; // the clicked button
        let trailerUrl = button.getAttribute('data-bs-trailer-url');

        // Append autoplay & playsinline
        if (trailerUrl.includes('?')) {
            trailerUrl += '&autoplay=1&playsinline=1';
        } else {
            trailerUrl += '?autoplay=1&playsinline=1';
        }

        videoIframe.src = trailerUrl;
    });

    // Clear iframe when modal is hidden
    trailerModal.addEventListener('hidden.bs.modal', function () {
        videoIframe.src = '';
    });
});
</script>

    {% endblock content %}