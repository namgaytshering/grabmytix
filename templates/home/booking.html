{% extends "../includes/base.html" %}

{% block title %}{{ movie.title }}  - GrabMyTix  {% endblock title %}

{% block meta %}
<meta name="description" content=" Showing: {{ filmshow.state.state_short|upper }} - {{filmshow.show_date}},{{filmshow.show_time|date:'h:i A' }} ">
{% endblock meta %}
:<q></q>
{% block content %}
<main class="content-wrapper">
    <!-- Hero Section -->
  <section class="position-relative" style="height: 40vh; min-height: 400px; overflow: hidden;">

    <!-- Blurred Background -->
    <div class="position-absolute top-0 start-0 w-100 h-100" style="
      background-image: url('/media/{{ movie.poster_image }}');
      background-size: cover;
      background-position: top;
      filter: blur(20px);
      transform: scale(1.1);
      z-index: 1;">
    </div>

    <!-- Dark overlay -->
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0,0,0,0.25); z-index: 2;">
    </div>

    <!-- Foreground image (same height as section) -->
    <div class="position-relative d-flex justify-content-center align-items-center h-100" style="z-index: 3;">
      <img src="/media/{{ movie.poster_image }}" alt="{{ movie.title }} Poster" style="
           height: 100%;
           object-fit: contain;
           object-position: top;
           filter: brightness(1.01);
         ">
    </div>

    <!-- Hero text -->
    <div class="position-absolute bottom-0 start-0 p-4 text-white w-100" style="z-index: 4;  ">
      <h1 class="fw-bold text-white  alert-heading mb-2">{{ movie.title }}</h1>
      <h5 class="text-white">{{ movie.genre }}</h5>
      <p class="mb-1">
        <i class="ci-clock"></i> {{ movie.duration }} hr{{ movie.duration|pluralize }}
      </p>
      <small><b>Director:</b> {{ movie.director }}</small><br>
      <small><b>Language:</b> {{ movie.language }}</small><br>
       <small><b>Cast:</b> {{ movie.cast|capfirst }}</small>
    </div>
  </section>


  <!-- Movie Info Section -->
  <!-- <section class="container" style="max-width: 900px;">
  
     
    <div class="row align-items-center justify-content-center text-center text-md-start">

    
      <div class="col-md-4 mb-4 mb-md-0 d-flex justify-content-center">
        <img src="/media/{{ movie.poster_image }}" alt="{{ movie.title }} Poster"
             class="img-fluid rounded shadow-sm" style="max-height: 400px; object-fit: contain;">
      </div>

     
      <div class="col-md-8">
        <h2 class="fw-bold ">{{ movie.title }}</h2>
          <span class="text ">
              <i class="ci-schedule"></i> 
              <b>{{filmshow.show_date}},{{filmshow.show_time|date:'h:i A' }}</b>
          </span>
     <br/>
      <small><i class="ci-map-pin  "></i></small> {{ filmshow.theater_name }}
      <br />
      <i class="ci-map-pin "></i> {{ filmshow.street }}, {{ filmshow.state }}, 
      {{filmshow.country }}
 
 
      </div>

    </div>
  </section> -->

  <!-- Payment Form Section -->
  <section class="p-0 p-md-5 p-lg-5 "  >
 
{%if messages%}
      {% for message in messages%}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {%endfor%}
      {%endif%}
      
    {% if form.non_field_errors %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>⚠ Please fix the following errors:</strong>
      <ul class="mb-0">
        {% for error in form.non_field_errors %}
        <li>{{ error }}</li>
        {% endfor %}
      </ul>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    

    <form method="POST" novalidate>
      {% csrf_token %}

      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body">

          <h1 class="fw-bold   alert-heading">Primary Person Details</h1>
    <!-- <p> Just one quick step to grab your tickets for <strong>{{ movie.title }}</strong> — let's make movie night unforgettable!
      </p> -->
      <div class="col-md-8">

          <span class="text ">
              <i class="ci-schedule"></i> 
              <b>{{filmshow.show_date}},{{filmshow.show_time|date:'h:i A' }}</b>
          </span>
          <br/>
            <small><i class="ci-map-pin  "></i></small> {{ filmshow.theater_name }}
            <br />
            <i class="ci-map-pin "></i> {{ filmshow.street }}, {{ filmshow.state }}, 
            {{filmshow.country }}
 
        <br/> <br/>
      </div>
 
          <div class="row  mb-4">

            <div class="col-md-4">
              <label for="{{ form.full_name.id_for_label }}" class="form-label fw-semibold">Full Name</label>
                  <div class="mb-3 position-relative">
                                <i class="ci-user position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"></i>
                                {{ form.full_name }}
                            </div>
              {% if form.full_name.errors %}
                <div class="text-danger small mt-1">{{ form.full_name.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="col-md-4">
              
              <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold">Email</label>
                 <div class="mb-3 position-relative">
                                <i class="ci-mail position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"></i>
                                {{ form.email }}
                            </div>
              {% if form.email.errors %}
                <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="col-md-4">
              <label for="{{ form.phone.id_for_label }}" class="form-label fw-semibold">Phone</label>
                  <div class="mb-3 position-relative">
                                <i class="ci-phone position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"></i>
                                {{ form.phone }}
                            </div>
              {% if form.phone.errors %}
                <div class="text-danger small mt-1">{{ form.phone.errors.0 }}</div>
              {% endif %}
            </div>

          </div>

          <hr class="my-4">

          <!-- Ticket Selection -->
          <h5 class="fw-semibold mb-3">Select Tickets</h5>

          <div class="row g-4 mb-4">

            <div class="col-md-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="fs-6 fw-semibold">Adult</span><br>
                  <small class="text-muted">Price: ${{ filmshow.adult }}</small>
                </div>
                <div class="input-group input-group-sm" style="width: 140px;">
                  <button type="button" class="btn btn-outline-secondary qty-btn" data-type="adult" data-action="decrement" aria-label="Decrease adult tickets">−</button>
                  <input type="number" min="0" id="adult-qty" name="no_adult" class="form-control text-center" value="{{ form.no_adult.value|default:1 }}">
                  <button type="button" class="btn btn-outline-secondary qty-btn" data-type="adult" data-action="increment" aria-label="Increase adult tickets">+</button>
                </div>
              </div>
            </div>

            <!-- <div class="col-md-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="fs-6 fw-semibold">Child</span><br>
                  <small class="text-muted">Price: ${{ filmshow.child }}</small>
                </div>
                <div class="input-group input-group-sm" style="width: 140px;">
                  <button type="button" class="btn btn-outline-secondary qty-btn" data-type="child" data-action="decrement" aria-label="Decrease child tickets">−</button>
                  <input type="number" min="0" id="child-qty" name="no_child" class="form-control text-center" value="{{ form.no_child.value|default:0 }}">
                  <button type="button" class="btn btn-outline-secondary qty-btn" data-type="child" data-action="increment" aria-label="Increase child tickets">+</button>
                </div>
              </div>
            </div> -->

          </div>

          <!-- Total Summary -->
          <div class="  border-top pt-3 mb-4">
            <strong class="fs-5">Total:</strong>
            <span id="final-total" class="fs-5 fw-bold">$0.00</span>
          </div>
     <!-- {{is_expired}} -->
          
            {% if is_expired %}
          <button type="submit" disabled class="btn btn-dark  rounded-pill fw-semibold" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="This is a demo; bookings are not available.">
            <i class="ci-shopping-bag me-2"></i>
         Expired – no more tickets available.
          </button>
          {%else%}
          <!-- Submit Button -->
          <button type="submit"   class="btn btn-danger btn-lg w-80" >
            Continue to Payment &nbsp;&nbsp;<i class="ci-chevron-right"></i>
          </button>
          <br/>  <br/>
          {%endif%}
         
          <p class="text-muted small mt-4 mb-0 text-center">
            By completing your purchase, you agree to our
            <a href="#" class="text-decoration-underline">Terms & Conditions</a> and
            <a href="#" class="text-decoration-underline">Refund Policy</a>.
          </p>

        </div>
      </div>
    </form>
  </section>
</main>

<!-- Script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(function () {
    var adultPrice = parseFloat("{{ filmshow.adult }}");
    var childPrice = parseFloat("{{ filmshow.child }}");

    function updateTotal() {
      var adultQty = parseInt($("#adult-qty").val()) || 0;
      var childQty = parseInt($("#child-qty").val()) || 0;
      var total = (adultQty * adultPrice) + (childQty * childPrice);
      $("#final-total").text(`$${total.toFixed(2)}`);
    }

    $(".qty-btn").click(function () {
      var type = $(this).data("type");
      var action = $(this).data("action");
      var input = (type === "adult") ? $("#adult-qty") : $("#child-qty");
      var value = parseInt(input.val()) || 0;
      if (action === "increment") value++;
      else if (action === "decrement" && value > 0) value--;
      input.val(value);
      updateTotal();
    });

    $("#adult-qty, #child-qty").on("input", updateTotal);
    updateTotal();
  });
</script>
{% endblock content %}
