{% extends "../includes/base.html" %}

{% block title %}
{{ movie.title }}
{% endblock title %}

{% block meta %}
<!-- Movie-Specific Meta Tags -->
<meta name="description" content="{% if shows %}
    Shows:
    {% for show in shows %}
      {{ show.state.state_short|upper }} - {{ show.show_date }}{% if not forloop.last %}, {% endif %}
    {% endfor %}
  {% endif %}">
<meta property="og:title" content="{{ movie.title }} - GrabMyTix" />
<meta property="og:description" content="{% if shows %}
    Shows:
    {% for show in shows %}
      {{ show.state.state_short|upper }} - {{ show.show_date }}  {% if not forloop.last %}, {% endif %}
    {% endfor %}
  {% endif %}" />
<meta property="og:image" content="https://www.grabmytix.com/media/{{ movie.poster_image }}" />
<meta property="og:image:alt" content="{{ movie.title }} Poster" />
<meta property="og:url" content="https://www.grabmytix.com/{{ movie.slug }}/" />
<meta property="og:type" content="movies" />
<meta name="keywords" content="{{ movie.title }}, movie tickets, {{ movie.genre }}, book online">
<meta name="author" content="GrabMyTix">
{% endblock meta %}

{% block content %}
<main class="content-wrapper">
  <section class="position-relative" style="height: 40vh; min-height: 400px; overflow: hidden;">

    <!-- Blurred Background -->
    <div class="position-absolute top-0 start-0 w-100 h-100" style="
      background-image: url('/media/{{ movie.poster_image }}');
      background-size: cover;
      background-position: top;
      filter: blur(20px);
      transform: scale(1.1);
      z-index: 1;">
    </div>

    <!-- Dark overlay -->
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0,0,0,0.25); z-index: 2;">
    </div>

    <!-- Foreground image (same height as section) -->
    <div class="position-relative d-flex justify-content-center align-items-center h-100" style="z-index: 3;">
      <img src="/media/{{ movie.poster_image }}" alt="{{ movie.title }} Poster" style="
           height: 100%;
           object-fit: contain;
           object-position: top;
           filter: brightness(1.01);
         ">
    </div>

    <!-- Hero text -->
    <div class="position-absolute bottom-0 start-0 p-4 text-white w-100" style="z-index: 4;  ">
      <h1 class="fw-bold text-white  alert-heading mb-2">{{ movie.title }}</h1>
      <h5 class="text-white">{{ movie.genre }}</h5>
      <p class="mb-1">
        <i class="ci-clock"></i> {{ movie.duration }} hr{{ movie.duration|pluralize }}
      </p>
      <small><b>Director:</b> {{ movie.director }}</small><br>
      <small><b>Language:</b> {{ movie.language }}</small><br>
          <small><b>Cast:</b> {{ movie.cast|capfirst }}</small>
    </div>
  </section>

  <!-- Movie Details Section -->
  <section class="container pb-4 pb-md-5">
    <!-- Messages -->
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}

    <!-- Show Locations -->
    <section class="mt-5">
      <div class="  mb-4">
        <h1 class="alert-heading mb-2">Pick a Show Location</h1>
        <p class="text-muted">Browse available shows by state and choose your preferred theater and time.</p>
      </div>
      <!-- Flush list group to render items edge-to-edge in a parent container (e.g., cards) -->


    
      {% regroup shows by state as state_list %}
      {% for state in state_list %}

      <!-- State Header -->

      <h5 class="alert-heading mb-2"> <i class="bi bi-geo-alt-fill me-2"></i> {{ state.grouper }}</h5>

      <!-- Shows under each state -->
      <div class="list-group">
        {% for show in state.list %}

        <a class="list-group-item mb-4 list-group-item-action p-3 fw-normal " href="/show/{{ show.slug }}" aria-current="true">
          <div>
            <h6 class="mb-1">{{ show.theater_name |capfirst}}</h6>

          </div>
          <small class="mb-1">{{ show.street |capfirst}},{{ show.state.state_short |upper}}</small>
          <br/>
          <small>Date: {{ show.show_date }}, {{ show.show_time|date:'h:i A' }}</small>
         <br/><br/> <button class="btn btn-sm btn-danger"><i class="ci-ticket"></i> &nbsp; Grab a ticket  <i class="ci-chevron-right"></i></button>
        </a>
        {% endfor %}
      </div>
      {% empty %}
      <p class="fst-italic text-center">No shows available at the moment. Please check back later.</p>
      {% endfor %}

      </ul>

    </section>



    <div>
      <!-- Summary -->
      <section class="mt-md-2 mb-lg-4">
        <h1 class="alert-heading mb-2">Summary</h1>
        <p class="mb-0  " style="line-height: 1.6;">
          {{ movie.description|safe }}
        </p>
      </section>
      <div>
        <iframe width="100%" height="400" src="{{ movie.trailer }}" title="Trailer for {{ movie.title }}"
          frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
        </iframe>
      </div>
    </div>


  </section>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock content %}